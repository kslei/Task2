const container=document.querySelector(".map"),mans=document.querySelectorAll(".mans"),gajets=document.querySelectorAll(".gajets"),users=document.querySelector(".text__users"),next=document.querySelector(".next"),storage=document.querySelector(".text__storage"),byteCloud=document.querySelector(".text__byteCloud"),startAgain=document.querySelector(".text__startAgain"),start=document.querySelector(".start"),restart=document.querySelector(".restart"),circles=document.querySelectorAll(".circle"),modal=document.querySelector(".modal"),time=3e3,distances=[{path:"europe_germany",latency:19.769},{path:"europe_east-usa",latency:97.798},{path:"europe_west-usa",latency:170.207},{path:"europe_singapore",latency:182.078},{path:"asia_germany",latency:296.262},{path:"asia_east-usa",latency:232.983},{path:"asia_west-usa",latency:143.422},{path:"asia_singapore",latency:70.663},{path:"north-america_germany",latency:122.733},{path:"north-america_east-usa",latency:48.174},{path:"north-america_west-usa",latency:32.798},{path:"north-america_singapore",latency:204.497},{path:"south-america_germany",latency:174.77},{path:"south-america_east-usa",latency:139.533},{path:"south-america_west-usa",latency:181.719},{path:"south-america_singapore",latency:367.718},{path:"oceania_germany",latency:255.303},{path:"oceania_east-usa",latency:207.875},{path:"oceania_west-usa",latency:179.444},{path:"oceania_singapore",latency:92.456}];let max=distances.reduce((e,t)=>e.latency>t.latency?e:t).latency;var serverStorage,gajetActive=[],serverByteCloud=[],regions=[],tableByteCloud=[],tableStorage=[];let count=0,countServer=0;var routes=[],latencies=[];function showGajets(e){let t=e.target.offsetParent;regions.includes(t.className)||regions.push(t.className);let a=e.target.className.split("__")[1];void 0!==a&&(e.target.parentElement.style.display="none",gajets.forEach(e=>{if(e.parentElement===t){next.style.display="block",e.style.display="flex";for(let l=0;l<e.children.length;l++){let r=e.children[l].className.split("__")[1];if("large"===a||"medium"===a&&"large"!==r||"small"===a&&"small"===r){e.children[l].style.opacity=1;let a=t.className+"_"+r;gajetActive.push(a)}}}}),regions.length>4&&showCircle())}function showCircle(){mans.forEach(e=>{e.style.display="none"}),circles.forEach(e=>{e.style.display="block",e.parentElement.style.zIndex=5}),users.style.display="none",storage.style.display="flex"}function showServer(e){e.target.style.display="none",storage.style.display="none",byteCloud.style.display="flex",start.style.display="block";let t=e.target.nextElementSibling;t.style.display="block",0===countServer&&(t.style.background='url("./img/server.png") center/contain no-repeat',serverStorage=e.target.parentElement.className),0!==countServer&&(t.style.background='url("./img/server_ByteCloud.png") center/contain no-repeat'),serverByteCloud.push(e.target.parentElement.className),countServer+=1,countServer>2&&(start.style.color="rgb(0, 0, 255)",start.style.cursor="pointer",start.addEventListener("click",startTest)),countServer==circles.length&&startTest()}function startTest(){start.removeEventListener("click",startTest),circles.forEach(e=>{e.style.display="none"}),byteCloud.style.display="none";for(let e=0;e<regions.length;e++){let t,a=max;for(let l=0;l<serverByteCloud.length;l++){let r=regions[e]+"_"+serverByteCloud[l],n=distances.find(e=>e.path===r).latency;n<a&&(a=n,t=r.split("_")[1]+"_"+r.split("_")[0])}routes.push(t),latencies.push(a)}drawPath(tableByteCloud,routes,latencies),routes=[],latencies=[];for(let e=0;e<regions.length;e++){let t,a=regions[e]+"_"+serverStorage,l=distances.find(e=>e.path===a).latency;t=a.split("_")[1]+"_"+a.split("_")[0],routes.push(t),latencies.push(l)}setTimeout(()=>{document.querySelectorAll(".path").forEach(e=>e.remove()),document.querySelectorAll("span").forEach(e=>e.remove()),count+=1,drawPath(tableStorage,routes,latencies),setTimeout(showModal,3e3)},3100)}function drawPath(e,t,a){for(let l=0;l<t.length;l++){let r={region:"",latency:0,download:0,video:"",rating:0,number:0},n=0;for(let e=0;e<gajetActive.length;e++)if(gajetActive[e].split("_")[0]===t[l].split("_")[1]){gajets.forEach(t=>{if(t.parentElement.className===gajetActive[e].split("_")[0])for(let r=0;r<t.children.length;r++)t.children[r].className.split("__")[1]==gajetActive[e].split("_")[1]&&(t.children[r].firstChild.firstChild.style.transition=`width ${10*a[l]}ms ease-in`,t.children[r].firstChild.firstChild.style.width="100%",setTimeout(()=>{t.children[r].firstChild.firstChild.style.transition="width 0ms ease-in",t.children[r].firstChild.firstChild.style.width="0%"},3e3))}),n+=1;let r="./img/arc_"+t[l].split("_")[0]+"_"+gajetActive[e]+".png",s=document.createElement("div");s.className="path",s.style.backgroundImage=`url(${r})`,container.append(s)}let s=document.createElement("span");s.className="des__"+t[l],container.append(s),s.innerHTML=`latency: ${a[l]} ms`,r.region=t[l].split("_")[1],r.latency=a[l],r.number=n,a[l]<=100?(r.rating=5,r.video="2K/2160p Ultra HD",r.download=Math.round(3*a[l])):a[l]<=150?(r.video="2K/2160p Ultra HD",r.rating=4,r.download=Math.round(3.5*a[l])):a[l]<=200?(r.video="1080p Full HD",r.rating=3,r.download=Math.round(4*a[l])):a[l]<=250?(r.video="720p HD Ready",r.rating=2,r.download=Math.round(4.5*a[l])):(r.video="480p",r.rating=1,r.download=Math.round(5*a[l])),setTimeout(()=>{s.innerHTML=`time: ${r.download} ms`},10*a[l]),e.push(r)}}function showModal(){startAgain.style.display="flex",modal.style.display="flex",drowTable(tableByteCloud),drowTable(tableStorage),container.firstElementChild.style.filter="blur(2px)",document.querySelectorAll("span").forEach(e=>e.remove()),document.querySelectorAll(".path").forEach(e=>e.style.filter="blur(2px)"),gajets.forEach(e=>{e.style.display="none";for(let t of e.children)t.style.opacity=0}),circles.forEach(e=>{e.nextElementSibling.style.display="none"})}function toUp(e){let t=e.split("-"),a=[];for(let e=0;e<t.length;e++)a.push(t[e][0].toUpperCase()+t[e].slice(1));return a.join(" ")}function drowTable(e){e.sort((e,t)=>t.number-e.number).forEach(e=>{let t=document.createElement("div");t.className="table__item",1===count?modal.firstElementChild.append(t):modal.lastElementChild.append(t);let a=document.createElement("div");a.className="header",t.append(a);let l=document.createElement("div");l.className="header__title",a.append(l);let r=toUp(e.region);l.innerHTML=r;let n=document.createElement("ul");n.className="rating",a.append(n);for(let t=0;t<5;t++){let a=document.createElement("li");e.rating>t?a.className="star_active":a.className="star",n.append(a)}let s=document.createElement("div");s.className="data",t.append(s);let o=document.createElement("div");o.className="latency",s.append(o),o.innerHTML="Latency<br>"+Math.floor(e.latency);let c=document.createElement("div");c.className="download",s.append(c),c.innerHTML=`Download time<br>${e.download} ms`;let i=document.createElement("div");i.className="video",s.append(i),i.innerHTML="Video streaming<br>"+e.video}),count+=1}function reload(){startAgain.style.display="none",users.style.display="flex",next.style.display="none",container.firstElementChild.style.filter="none",document.querySelectorAll(".table__item").forEach(e=>e.remove()),mans.forEach(e=>e.style.display="flex"),document.querySelectorAll(".path").forEach(e=>e.remove()),modal.style.display="none",circles.forEach(e=>{e.parentElement.style.zIndex=2}),start.style.color="rgba(0, 0, 255, 0.37)",start.style.cursor="auto",gajetActive=[],serverByteCloud=[],regions=[],tableByteCloud=[],tableStorage=[],serverStorage="",count=0,countCircle=0,countServer=0,routes=[],latencies=[]}mans.forEach(e=>{e.addEventListener("click",showGajets)}),next.addEventListener("click",showCircle),circles.forEach(e=>{e.onclick=showServer}),startAgain.addEventListener("click",reload);